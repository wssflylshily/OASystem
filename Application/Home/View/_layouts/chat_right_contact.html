		<!--右侧联系人-->
		<div class="right_bar">
			<div class="r_top clear contact_kind">
			<if condition="$single_talk eq 0">
				<div class="L on"><img src="__PUBLIC__/img/i_img_05.png"> 最近联系人</div>
				<div class="R"><img src="__PUBLIC__/img/i_img_09.png" title="群组"><i class="new_notice"></i></div>
				<div class="R"><img src="__PUBLIC__/img/i_img_07.png" title="通讯录"></div>
			<elseif condition="$single_talk eq 1" />
				<div class="L"><img src="__PUBLIC__/img/i_img_05.png"> 最近联系人</div>
				<div class="R"><img src="__PUBLIC__/img/i_img_09.png" title="群组"><i class="new_notice"></i></div>
				<div class="R on"><img src="__PUBLIC__/img/i_img_07.png" title="通讯录"></div>
			<else />
				<div class="L"><img src="__PUBLIC__/img/i_img_05.png"> 最近联系人</div>
				<div class="R on"><img src="__PUBLIC__/img/i_img_09.png" title="群组"><i class="new_notice"></i></div>
				<div class="R"><img src="__PUBLIC__/img/i_img_07.png" title="通讯录"></div>		
			</if>
			</div>
			<div class="contact_list">
				<!--常用-->
				<div class="changyong">
					<ul class="usually_list">
						<foreach name="single" item="user">
							<li class="clear">
								<div class="L online">
									<a href="__ROOT__/home/chat/talk_person/user_id/{$user.id}" class="Show">
										<h2 class="font13 blackcolor txt_oneline">{$user.name}</h2>
										<h3 class="font12 graycolor txt_oneline">{$user.d_name}</h3>
									</a>
								</div>
							</li>
						</foreach>
					</ul>
					<div class="contact_operate">
						<!-- <button type="button" class="button1 all_delete">清空所有记录</button> -->
					</div>
				</div>
				<!--群组-->
				<div class="qunzu Hide">
					<ul class="usually_list">
						<foreach name="group" item="qun">
							<li class="clear">
								<div class="L online">
									<a href="__ROOT__/home/chat/group_chat/id/{$qun.id}" class="Show">
										<h2 class="font13 blackcolor txt_oneline">{$qun.room_name}</h2>
										<h3 class="font12 graycolor txt_oneline"></h3>
									</a>
								</div>
								<div class="R Hide">
									<a href="javascript:;" class="delete" data-id="{$qun.id}"><img src="__PUBLIC__/img/i_img_25.png"></a>
								</div>
							</li>
						</foreach>
					</ul>
					<div class="contact_operate">
						<div class="L font12"><button class="qunzu_guanli" type="button" style="padding: 7px 0px; color: #2567d6;">管理</button></div>
						<button type="button" class="buttonc blue add_personzu">新建群组</button>
					</div>
				</div>
				<!--联系人-->
				<div class="lianxiren Hide">
					<div class="cotact_person">
					<foreach name="friends_list" key="k" item="v">
						<dl class="blackcolor">
							<dt class="font13 clear">
								<div class="L one txt_oneline">{$v.department_name}</div>
								<div class="L">&nbsp;({$v.count})</div>
							</dt>
							<dd class="font13">
							<foreach name="v['friends_list']" key="k1" item="v1">
								<div class="clear"><a href="__ROOT__/home/chat/talk_person?user_id={$v1.user_id}" class="L blackcolor">{$v1.friend_name} </a><div class="R cursor delete Hide" data_id="{$v1.user_id}">x</div></div>
							</foreach>
							</dd>
						</dl>
					</foreach>
					</div>
					<div class="contact_operate">
						<div class="L font12"><button class="haoyou_guanli" type="button" style="padding: 7px 0px; color: #2567d6;">管理</button></div>
						<button type="button" class="buttonc blue add_person"><img src="__PUBLIC__/img/person.png"> 添加联系人</button>
						<a href="javascript:;" class="notice_p notice_per"><img src="__PUBLIC__/img/liaotianq.png">
						<if condition="$apply_friends_show neq null">
						    <i class="notice_d"></i>
						</if>
						</a>
					</div>
				</div>
			</div>
		</div>
		<!--主动添加好友-->
		<div id="add_person_box" class="Hide">
			<div class="houqi_select clear">
				<div class="L col-12">
					<div class="houqi_search">
						<div class="search_txt clear font13">
							<input class="L" name="search_con" placeholder="输入姓名/手机号查询" type="text">
							<span class="R"></span>
						</div>
					</div>
					<div class="h_one">
						<div class="h_search">
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<!--系统消息-->
		<div id="system_message" class="Hide">
		<foreach name="apply_list" key="k"  item="v">
			<div class="day_time">
				<div class="sys_ask_time font13"><span>{$v.today}</span></div>
				<foreach name="v['list']" item="v1" key="k1">
				<div class="font13 ask_list" data_id="{$v1.id}">
					<div class="clear">
						<div class="L"><em class="graycolor">{$v1.a_create_time|date="H:i:s",###}</em><em class="bluecolor">&nbsp;&nbsp;{$v1.a_name}</em> 请求添加您为好友。</div>
						<div class="R font12"><button type="button" class="buttonc blue sys_tongyi_btn">同意</button>&nbsp;&nbsp;<button type="button" class="buttonc gray sys_jujue_btn">拒绝</button></div>
					</div>
					<div>{$v1.a_content}</div>
				</div>
				</foreach>
			</div>
		</foreach>
		</div>
		<!--当前群聊的信息-->
		<div id="mow_quninfor" class="Hide">
			<div class="houqi_select clear">
				<div class="L col-6">
					<div class="houqi_search">
						<div class="search_txt clear font13">
							<input class="L qunzu" name="search_con" type="text">
							<span class="R"></span>
						</div>
					</div>
					<div class="h_one">
						<div class="h_search">
							<dl>
								<dd id="search_user">
								</dd>
							</dl>
						</div>
						<div class="h_content">
							
							<foreach name="friends_list" key="k" item="v">
								<dl>
								<dt><em class="add_all" title="添加整组"></em><span class="div_inblock one"><b>{$v.department_name}</b></span><span>({$k+1})</span></dt>
								<dd class="clear">
									<foreach name="v['friends_list']" key="k1" item="v1">
								
										<div class="Show txt_oneline" data_id="{$v1.user_id}">{$v1.friend_name}</div>
									</foreach>
									
									
								</dd>
							</dl>

							</foreach>
						</div>
						
					</div>
				</div>
				
				<div class="R col-6">
					<div class="font13 clear">
						<div class="L" style="padding: 7px 10px;"><b>群名称:</b></div>
						<div class="R" style="border: 1px solid #DDDDDD; width: 194px; border-radius: 4px; padding: 5px 10px; margin: 0px 10px 5px 0px;">
						<div><input type="text" name="qunzu_name" class="qunzu_name" style="width: 100%;" placeholder="群名称" value="群组1" /></div></div>
					</div>
					
					<div style="padding: 10px; line-height: 10px;"><b>群成员：</b></div>
					<div class="h_one" style="height: 238px;">
						<ul class="houqi_old">
							<li class="clear"><div class="L txt_oneline">二级内容</div><div class="R" data_id="7"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容8</div><div class="R" data_id="8"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容9</div><div class="R" data_id="9"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容</div><div class="R" data_id="7"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容8</div><div class="R" data_id="8"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容9</div><div class="R" data_id="9"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容</div><div class="R" data_id="7"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容8</div><div class="R" data_id="8"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容9</div><div class="R" data_id="9"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容</div><div class="R" data_id="7"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容8</div><div class="R" data_id="8"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容9</div><div class="R" data_id="9"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容</div><div class="R" data_id="7"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容8</div><div class="R" data_id="8"></div></li>
							<li class="clear"><div class="L txt_oneline">二级内容9</div><div class="R" data_id="9"></div></li>
						</ul>
					</div>
				</div>
			</div>
			<input type="hidden" name="yx_chengyuan" />
			<div class="center_btn"><button type="button" class="buttonc red houqi_ok">确定</button></div>
			
		</div>
		<script type="text/javascript">
			//-------------群设置按钮操作-------------------
			var obj;
			
			//弹窗二级
			$(document).on("click",".houqi_select dl dt span",function(){
				$(this).parent().siblings("dd").toggle();
			});
			//单个选择添加
			$(document).on("click",".select_tanchu dl dd div",function(){
				var s_id=$(this).attr("data_id");
				var s_name=$(this).html();
				//判断是否有重复
				var old_id=[];
				var panduan=true;
				for(var i=0;i<$(this).parents(".houqi_select").find(".houqi_old .R").length;i++)
				{
					old_id[i]=$(this).parents(".houqi_select").find(".houqi_old .R:eq("+i+")").attr("data_id");
					if(s_id==old_id[i])
					{
						panduan=false;
					}
				}
				if(panduan)
				{
					var add_str='<li class="clear"><div class="L txt_oneline">'+s_name+'</div><div class="R" data_id="'+s_id+'"><input type="hidden" value="'+s_id+'" name="userids[]" /></div></li>';
					$(this).parents(".houqi_select").find(".houqi_old").append(add_str);
				}
				
			});
			//添加全部
			$(document).on("click",".select_tanchu dl dt .add_all",function(){
				//初始所有选中
				var old_id=[];
				for(var i=0;i<$(this).parents(".houqi_select").find(".houqi_old .R").length;i++)
				{
					old_id[i]=$(this).parents(".houqi_select").find(".houqi_old .R:eq("+i+")").attr("data_id");
				}
				for(var j=0;j<$(this).parents("dt").siblings("dd").find("div").length;j++)
				{
					var s_id=$(this).parents("dt").siblings("dd").find("div:eq("+j+")").attr("data_id");
					var s_name=$(this).parents("dt").siblings("dd").find("div:eq("+j+")").html();
					//判断是否有重复
					var panduan=true;
					for(var k=0;k<old_id.length;k++)
					{
						if(s_id==old_id[k])
						{
							panduan=false;
						}
					}
					if(panduan)
					{
						var add_str='<li class="clear"><div class="L txt_oneline">'+s_name+'</div><div class="R" data_id="'+s_id+'"></div></li>';
						$(this).parents(".houqi_select").find(".houqi_old").append(add_str);
					}
				}
			});
			//选择删除
			$(document).on("click",".select_tanchu .houqi_old li .R",function(){
				$(this).parents("li").remove();
			});
			//群组_修改
			$(document).on("click",".houqi_ok",function(){
				//新增群组跳转到群组聊天页面
				if($(this).parents(".select_tanchu").hasClass("new_add_tanchu"))
				{
					obj.html($(this).parents(".select_tanchu").html());
					$(".houqi_search .search_txt .delete").click();
					var str_id="",str_name="";
					var qunzu_str="";

					for(var i=0;i<obj.find(".houqi_old .R").length;i++)
					{
						//old_id[i]=$(this).parents(".houqi_select").find(".houqi_old .R:eq("+i+")").attr("data_id");
						str_id+=obj.find(".houqi_old .R:eq("+i+")").attr("data_id");
						str_name+=obj.find(".houqi_old .R:eq("+i+")").siblings(".L").html();
						if(i!=obj.find(".houqi_old .R").length-1)
						{
							str_id+=",";
							str_name+=";";
						}
					}
					obj.find("input[name='yx_chengyuan']").val(str_id);
					//console.log(obj.find("input[name='yx_chengyuan']").val());
					obj.find(".qunzu_name").val($(this).parents(".select_tanchu").find(".qunzu_name").val());
					if(obj.find(".qunzu_name").val()=="")
					{
						qunzu_str="未命名";
					}
					else
					{
						qunzu_str=obj.find(".qunzu_name").val();
					}
					//console.log(qunzu_str);
					$(".layui-layer-close").click();
					//console.log(str_id,qunzu_str);
					$.ajax({
						 type:"GET",
						data:{userids:str_id, qunzu_name:qunzu_str},
						 url:"__ROOT__/home/chat/create_group",
						 success:function(a) {
							 if (a==1) {
							 	layer.msg('创建成功');
							 	//alert(2);
							 	window.location.reload();
							 }else{
							 	layer.msg('创建失败');
							 }
						 }
					 });
				}
				
			})
			//-----------新建群组----------
			$(".add_personzu").click(function(){
				obj=$("#mow_quninfor");
				//alert(1);
				layer.open({
				  title:"新建群",
				  type: 1,
				  skin: 'layui-box', //加上边框
				  area: ['620px', '432px'], //宽高
				  content: '<div class="select_tanchu new_add_tanchu clear"></div>'
				});
				$(".select_tanchu").html(obj.html());
				//赋值input
				$(".select_tanchu").find(".qunzu_name").val("");
				$(".select_tanchu").find("input[name='yx_chengyuan']").val("");
				$(".select_tanchu .houqi_old").html("");
			});	
			
			//----------右侧联系人面板------------
			
			//常用联系人删除
			$(document).on("click",".changyong .usually_list li .delete",function(){
				var id = $(this).val();
				$.ajax({
					 type:"GET",
					data:{id:id},
					 url:"__ROOT__/home/ajax/delete_group",
					 success:function(a) {
						 if (a==1) {
						 	layer.msg('删除成功');
						 }else{
						 	layer.msg('删除失败');
						 }
					 }
				 });
				$(this).parents("li").remove();
			});
			//清空常用联系人
			$(".contact_operate .all_delete").click(function(){
				$(".changyong .usually_list").html("");
			})
			//选项卡
			$(".contact_kind > div").click(function(){
				var index=$(this).index();
				$(this).addClass("on").siblings().removeClass("on");
				$(".contact_list > div:nth-child("+(index+1)+")").show().siblings().hide();
			})
			//联系人分组
			// $(".lianxiren dl dt").click(function(){
			// 	$(this).siblings("dd").toggle();
			// 	$(this).parent("dl").toggleClass("on");
			// });
			
			//--------添加新的联系人-------------
			
			//添加;联系人
			$(".contact_operate .add_person").click(function(){
				layer.open({
				  title:"添加联系人",
				  type: 1,
				  skin: 'layui-box', //加上边框
				  area: ['320px', '380px'], //宽高
				  content: '<div id="addper_list"></div>'
				});
				
				$("#addper_list").html($("#add_person_box").html());
				
			});
			//添加联系人搜索
			$(document).on("input propertychange",".houqi_search .search_txt input",function(){

				var c=1;
				if(c==1)
				{
					//c=2;
				    var a = $(this);
					if($(this).val()!=""){
						$(this).siblings(".R").addClass("delete");
						$(this).parents(".houqi_search").siblings(".h_one").children(".h_search").show();
						$(this).parents(".houqi_search").siblings(".h_one").children(".h_content").hide();
					}
					else
					{
						$(this).siblings(".R").removeClass("delete");
						$(this).parents(".houqi_search").siblings(".h_one").children(".h_search").hide();
						$(this).parents(".houqi_search").siblings(".h_one").children(".h_content").show();
					}
					
					if(!$(this).hasClass("qunzu"))
					{
						console.log(2);
					    var name = $(this).val();
	                    $.ajax({
							 type:"GET",
							data:{name:name},
							 url:"__ROOT__/home/ajax/search_friends",
							 success:function(json) {
								 var data = JSON.parse(json);
								 console.log(data);
	                             var str="";
								 if (data) {
									 for (var i=0;i<data.length;i++){
	                                     str+='<div class="find_per clear cursor" data_id="'+data[i].id+'"><div class="L widtha">'+data[i].name+'</div><div class="R"></div></div>';
									 }
								 }
	                             a.parents(".houqi_search").siblings(".h_one").children(".h_search").html(str);
							 }
						 });
						//搜索添加联系人
	//						var str='<div class="find_per clear cursor" data_id="12"><div class="L widtha">测试人才</div><div class="R"></div></div>';

					}
					else
					{
						console.log(1);
						var name = $(this).val();
	                    $.ajax({
							 type:"GET",
							data:{name:name},
							 url:"__ROOT__/home/ajax/search_friends_qunzu",
							 success:function(json) {
								 var data = JSON.parse(json);
								 console.log(data);
	                             var str="";
								 if (data) {
									 for (var i=0;i<data.length;i++){
	                                    
	                                     str+='<div class="Show txt_oneline" data_id="'+data[i].id+'">'+data[i].name+'</div>';
									 }
	                             	 a.parents(".houqi_search").siblings(".h_one").find(".h_search dl dd").html("");
	                                 a.parents(".houqi_search").siblings(".h_one").find(".h_search dl dd").html(str);
								 }
	                             
	                             
							 }
						 });
						//搜索群组人
						/*var str='<div class="Show txt_oneline" data_id="12">搜索内容</div><div class="Show txt_oneline" data_id="13">相同内容2</div>';
						$(this).parents(".houqi_search").siblings(".h_one").children(".h_search").html(str);*/
					};
					//c=2;
				}
			});
			//置为空
			$(document).on("click",".houqi_search .search_txt .delete",function(){
				$(this).siblings("input").val("");
				$(this).parents(".houqi_search").siblings(".h_one").children(".h_search").hide();
				$(this).parents(".houqi_search").siblings(".h_one").children(".h_content").show();
				$(this).removeClass("delete");
			});
			//请求添加联系人
			$(document).on("click",".find_per",function(){
				var name=$(this).find(".L").html();
				var id=$(this).attr("data_id");
				$(".layui-layer-close").click();
				layer.open({
				  title:"输入验证信息",
				  type: 1,
				  skin: 'layui-box', //加上边框
				  area: ['320px', '348px'], //宽高
				  content: '<div id="addper_addyanzheng"></div>'
				});
				var str='<div class="font13">请求添加   <em class="bluecolor">'+name+'</em> 为好友：</div>';
				str+='<div class="add_ask"><textarea placeholder="请输入验证信息!" class="textarea"></textarea></div>'
				str+='<div class="center_btn" style="margin-top:20px"><button type="button" class="buttonc gray add_peryz_qx">返回</button>&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" data_id="'+id+'" class="buttonc blue add_peryz_btn">确定</button></div>';
				$("#addper_addyanzheng").html(str);
			});
			//取消添加
			$(document).on("click",".add_peryz_qx",function(){
				$(".layui-layer-close").click();
			});
			//确认请求添加好友
			$(document).on("click",".add_peryz_btn",function(){
				var a = $(this);
				var id=$(this).attr("data_id");
				var ask_c=$("#addper_addyanzheng textarea").val();
				console.log(id,ask_c);
                $.ajax({
					type:"GET",
					data:{id:id,ask_c:ask_c},
					url:"__ROOT__/home/ajax/apply_friends",
					 success:function(json){
						 var data = JSON.parse(json);
						 layer.msg(data.msg);
						 // console.log(data);
    //                      var str="";
						 // if (data) {
						 // }
                         a.parents(".houqi_search").siblings(".h_one").children(".h_search").html(str);
					 }
				 });	
				$(".layui-layer-close").click();
			});
			
			//--------系统消息-------------
			$(".notice_per").click(function(){
				layer.open({
				  title:"验证消息",
				  type: 1,
				  skin: 'layui-box', //加上边框
				  area: ['520px', '348px'], //宽高
				  content: '<div id="sys_ask"></div>'
				});
				$("#sys_ask").html($("#system_message").html());
			});
			//同意好友请求
			//sys_tongyi_btn sys_jujue_btn ask_list  
			$(document).on("click",".sys_tongyi_btn",function(){
				var a = $(this);
				var id=$(this).parents(".ask_list").attr("data_id");
				var str='<em class="greencolor">已同意</em>';
				$(this).parent().html(str);
                $.ajax({
					type:"GET",
					data:{id:id},
					url:"__ROOT__/home/ajax/agree_apply",
					 success:function(json) {
					 	layer.msg('添加成功');
                         a.parents(".houqi_search").siblings(".h_one").children(".h_search").html(str);
					 }
				 });					
				$("#system_message").html($("#sys_ask").html());
				
			});
			//拒绝好友请求
			$(document).on("click",".sys_jujue_btn",function(){
				var a = $(this);
				var id=$(this).parents(".ask_list").attr("data_id");
				var str='<em class="redcolor">已拒绝</em>';
				$(this).parent().html(str);
				 $.ajax({
					type:"GET",
					data:{id:id},
					url:"__ROOT__/home/ajax/unagree_apply",
					 success:function(json) {
					 	layer.msg('已拒绝');
                         a.parents(".houqi_search").siblings(".h_one").children(".h_search").html(str);
					 }
				 });	
				$("#system_message").html($("#sys_ask").html());
			});
			
			
			//------------联系人管理---------
			
			//好友管理
			$(".haoyou_guanli").click(function(){
				if($(this).html()=="管理")
				{
					$(this).html("完成");
				}
				else
				{
					$(this).html("管理");
				}
				$(".lianxiren .cotact_person dl dd .R").toggleClass("Hide");
			});
			$(".lianxiren .cotact_person dl dd .R").click(function(){
				var del_obj=$(this).parents(".clear");
				var id=$(this).attr("data_id");
				layer.confirm('确定删除此好友？', {
				  btn: ['确定','取消'] //按钮
				}, function(){
					 $.ajax({
						type:"GET",
						data:{id:id},
						url:"__ROOT__/home/ajax/delete_friend",
						 success:function(json) {
							  //删除好友
							  del_obj.remove();
							  layer.msg('已删除该好友');
						 }
					 });	

				}, function(){
				});
			});
			//群组管理
			$(".qunzu_guanli").click(function(){
				if($(this).html()=="管理")
				{
					$(this).html("完成");
				}
				else
				{
					$(this).html("管理");
				}
				
				$(".qunzu .usually_list li .R").toggleClass("Hide");
			});
			//群组删除
			$(document).on("click",".qunzu .usually_list li .delete",function(){
				var del_obj=$(this).parents("li");
				var id = $(this).attr('data-id');
				layer.confirm('确定退出此群组？', {
				  btn: ['确定','取消'] //按钮
				}, function(){
					$.ajax({
						type:"GET",
						data:{id:id},
						url:"__ROOT__/home/chat/delete_group",
						 success:function(json) {
							  //删除群
							  del_obj.remove();
				  			layer.msg('已退出该群');
						 }
					 });	
				  
				  
				}, function(){
				});
			});

		</script>